<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Claim Management System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-bg: #f3f4f6;
            --white: #ffffff;
            --text-dark: #1f2937;
            --text-light: #6b7280;
            --border-color: #e5e7eb;
            --shadow-sm: 0 1px 2px 0 rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-dark);
        }

        body {
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            animation: slideDown 0.6s ease-out;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-tab {
            padding: 12px 24px;
            background: var(--white);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .nav-tab.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .content-section.active {
            display: block;
        }

        .form-container, .dashboard-container, .admin-container {
            background: var(--white);
            padding: 40px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-group textarea {
            grid-column: 1 / -1;
            min-height: 120px;
            resize: vertical;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary {
            background: var(--light-bg);
            color: var(--text-dark);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border-left: 4px solid var(--success-color);
        }

        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border-left: 4px solid var(--danger-color);
        }

        .table-container {
            overflow-x: auto;
            margin-top: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--white);
        }

        th {
            background: var(--light-bg);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-dark);
            border-bottom: 2px solid var(--border-color);
        }

        td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        tr:hover {
            background: var(--light-bg);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .stat-card p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .chart-container {
            background: var(--white);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
            position: relative;
            height: 400px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }

        .modal-header {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
        }

        .modal-close:hover {
            color: var(--text-dark);
        }

        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: var(--light-bg);
            border-radius: 8px;
        }

        .badge {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: #059669;
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: #d97706;
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #dc2626;
        }

        .badge-info {
            background: rgba(37, 99, 235, 0.2);
            color: var(--primary-color);
        }

        .export-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-light);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--text-dark);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .form-container, .dashboard-container, .admin-container {
                padding: 20px;
            }

            .nav-tabs {
                gap: 5px;
            }

            .nav-tab {
                padding: 10px 16px;
                font-size: 0.9rem;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            table {
                font-size: 0.9rem;
            }

            th, td {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .success-icon {
            font-size: 3rem;
            color: var(--success-color);
            margin-bottom: 10px;
        }

        .form-section-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
        }

        .error-message {
            color: var(--danger-color);
            font-size: 0.85rem;
            margin-top: 5px;
        }

        .required-field::after {
            content: " *";
            color: var(--danger-color);
        }

        .search-box {
            position: relative;
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 15px 12px 40px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
        }

        .search-box::before {
            content: "üîç";
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--light-bg);
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üõ°Ô∏è Insurance Claim Management System</h1>
            <p>Fast, Secure, and Efficient Claim Processing</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('form')">üìã Submit Claim</button>
            <button class="nav-tab" onclick="switchTab('dashboard')">üìä Dashboard</button>
            <button class="nav-tab" onclick="switchTab('admin')">‚öôÔ∏è Manage Claims</button>
        </div>

        <!-- FORM SECTION -->
        <div id="form" class="content-section active">
            <div class="form-container">
                <div id="successAlert" class="alert alert-success">
                    <div style="display: flex; align-items: center;">
                        <span class="success-icon">‚úì</span>
                        <div>
                            <strong>Success!</strong><br>
                            Your claim has been submitted successfully. Claim ID: <strong id="claimId"></strong>
                        </div>
                    </div>
                </div>

                <div id="errorAlert" class="alert alert-error"></div>

                <form id="claimForm" onsubmit="submitClaim(event)">
                    <!-- Personal Information Section -->
                    <div class="form-section-title">Personal Information</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="fullName" class="required-field">Full Name</label>
                            <input type="text" id="fullName" required>
                            <div class="error-message" id="fullNameError"></div>
                        </div>
                        <div class="form-group">
                            <label for="email" class="required-field">Email Address</label>
                            <input type="email" id="email" required>
                            <div class="error-message" id="emailError"></div>
                        </div>
                        <div class="form-group">
                            <label for="phone" class="required-field">Phone Number</label>
                            <input type="tel" id="phone" pattern="[0-9]{10}" placeholder="10 digit number" required>
                            <div class="error-message" id="phoneError"></div>
                        </div>
                        <div class="form-group">
                            <label for="aadhar" class="required-field">Aadhar Number</label>
                            <input type="text" id="aadhar" pattern="[0-9]{12}" placeholder="12 digit number" required>
                            <div class="error-message" id="aadharError"></div>
                        </div>
                    </div>

                    <!-- Address Section -->
                    <div class="form-section-title">Address Details</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="address" class="required-field">Street Address</label>
                            <input type="text" id="address" required>
                        </div>
                        <div class="form-group">
                            <label for="city" class="required-field">City</label>
                            <input type="text" id="city" required>
                        </div>
                        <div class="form-group">
                            <label for="state" class="required-field">State</label>
                            <select id="state" required onchange="updateStateInfo()">
                                <option value="">Select State</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="country" class="required-field">Country</label>
                            <select id="country" required onchange="updateCountries()">
                                <option value="">Select Country</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="pincode" class="required-field">Pincode</label>
                            <input type="text" id="pincode" pattern="[0-9]{6}" placeholder="6 digit pincode" required>
                        </div>
                    </div>

                    <!-- Insurance Information Section -->
                    <div class="form-section-title">Insurance Information</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="policyNumber" class="required-field">Policy Number</label>
                            <input type="text" id="policyNumber" required>
                        </div>
                        <div class="form-group">
                            <label for="claimType" class="required-field">Claim Type</label>
                            <select id="claimType" required>
                                <option value="">Select Claim Type</option>
                                <option value="Medical Reimbursement">Medical Reimbursement</option>
                                <option value="Hospitalization">Hospitalization</option>
                                <option value="Accidental Death">Accidental Death</option>
                                <option value="Disability Benefit">Disability Benefit</option>
                                <option value="Critical Illness">Critical Illness</option>
                                <option value="Maternity Benefit">Maternity Benefit</option>
                                <option value="Dental Treatment">Dental Treatment</option>
                                <option value="Vision Care">Vision Care</option>
                                <option value="Mental Health">Mental Health</option>
                                <option value="Preventive Care">Preventive Care</option>
                                <option value="Emergency Medical">Emergency Medical</option>
                                <option value="Surgical Procedure">Surgical Procedure</option>
                                <option value="Chronic Disease">Chronic Disease</option>
                                <option value="Prescription Drugs">Prescription Drugs</option>
                                <option value="Rehabilitation">Rehabilitation</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="claimAmount" class="required-field">Claim Amount (‚Çπ)</label>
                            <input type="number" id="claimAmount" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="incidentDate" class="required-field">Incident Date</label>
                            <input type="date" id="incidentDate" required>
                        </div>
                    </div>

                    <!-- Claim Details Section -->
                    <div class="form-section-title">Claim Details</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="claimDescription" class="required-field">Claim Description</label>
                            <textarea id="claimDescription" placeholder="Describe the incident and claim details..." required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="hospitalName">Hospital/Provider Name</label>
                            <input type="text" id="hospitalName">
                        </div>
                        <div class="form-group">
                            <label for="treatmentType">Type of Treatment</label>
                            <select id="treatmentType">
                                <option value="">Select Treatment Type</option>
                                <option value="OPD">OPD (Out Patient)</option>
                                <option value="IPD">IPD (In Patient)</option>
                                <option value="Surgery">Surgery</option>
                                <option value="Consultation">Consultation</option>
                                <option value="Diagnostic">Diagnostic Tests</option>
                                <option value="Pharmacy">Pharmacy</option>
                                <option value="Physiotherapy">Physiotherapy</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="priority" class="required-field">Priority Level</label>
                            <select id="priority" required>
                                <option value="Normal">Normal</option>
                                <option value="High">High</option>
                                <option value="Urgent">Urgent</option>
                            </select>
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="form-section-title">Additional Information</div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="documentType">Supporting Documents</label>
                            <select id="documentType" multiple>
                                <option value="Medical Bill">Medical Bill</option>
                                <option value="Prescription">Prescription</option>
                                <option value="Test Report">Test Report</option>
                                <option value="Discharge Summary">Discharge Summary</option>
                                <option value="Insurance Card">Insurance Card</option>
                                <option value="ID Proof">ID Proof</option>
                                <option value="Accident Report">Accident Report</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="additionalNotes">Additional Notes</label>
                            <textarea id="additionalNotes" placeholder="Any additional information..."></textarea>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn-primary">Submit Claim</button>
                        <button type="reset" class="btn-secondary">Clear Form</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- DASHBOARD SECTION -->
        <div id="dashboard" class="content-section">
            <div class="dashboard-container">
                <h2 style="margin-bottom: 30px;">Dashboard & Analytics</h2>

                <div class="stats-grid">
                    <div class="stat-card">
                        <h3 id="totalClaims">0</h3>
                        <p>Total Claims</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
                        <h3 id="approvedClaims">0</h3>
                        <p>Approved Claims</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        <h3 id="pendingClaims">0</h3>
                        <p>Pending Claims</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                        <h3 id="rejectedClaims">0</h3>
                        <p>Rejected Claims</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #8b5cf6, #6d28d9);">
                        <h3 id="totalAmount">‚Çπ0</h3>
                        <p>Total Amount Claimed</p>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">
                        <h3 id="approvedAmount">‚Çπ0</h3>
                        <p>Total Amount Approved</p>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="claimStatusChart"></canvas>
                </div>

                <div class="chart-container">
                    <canvas id="claimTypeChart"></canvas>
                </div>

                <div class="chart-container">
                    <canvas id="claimTrendChart"></canvas>
                </div>
            </div>
        </div>

        <!-- ADMIN SECTION -->
        <div id="admin" class="content-section">
            <div class="admin-container">
                <h2 style="margin-bottom: 30px;">Manage Claims</h2>

                <div class="export-options">
                    <button class="btn-primary btn-sm" onclick="exportToCSV()">üì• Export to CSV</button>
                    <button class="btn-success btn-sm" onclick="exportToPDF()">üìÑ Export to PDF</button>
                    <button class="btn-secondary btn-sm" onclick="printClaims()">üñ®Ô∏è Print</button>
                </div>

                <div class="filter-section">
                    <input type="text" id="searchInput" placeholder="Search by claim ID, name, or policy number..." class="search-box" onkeyup="filterClaims()">
                    <select id="statusFilter" onchange="filterClaims()">
                        <option value="">All Status</option>
                        <option value="Pending">Pending</option>
                        <option value="Approved">Approved</option>
                        <option value="Rejected">Rejected</option>
                        <option value="Under Review">Under Review</option>
                    </select>
                    <select id="claimTypeFilter" onchange="filterClaims()">
                        <option value="">All Claim Types</option>
                        <option value="Medical Reimbursement">Medical Reimbursement</option>
                        <option value="Hospitalization">Hospitalization</option>
                        <option value="Accidental Death">Accidental Death</option>
                        <option value="Disability Benefit">Disability Benefit</option>
                        <option value="Critical Illness">Critical Illness</option>
                    </select>
                    <select id="priorityFilter" onchange="filterClaims()">
                        <option value="">All Priorities</option>
                        <option value="Normal">Normal</option>
                        <option value="High">High</option>
                        <option value="Urgent">Urgent</option>
                    </select>
                </div>

                <div class="table-container">
                    <table id="claimsTable">
                        <thead>
                            <tr>
                                <th>Claim ID</th>
                                <th>Name</th>
                                <th>Claim Type</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Priority</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="claimsTableBody">
                            <tr>
                                <td colspan="8" style="text-align: center; color: var(--text-light);">No claims submitted yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- View Claim Modal -->
    <div id="viewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Claim Details</h3>
                <button class="modal-close" onclick="closeModal('viewModal')">&times;</button>
            </div>
            <div id="modalBody"></div>
            <div class="button-group">
                <button class="btn-primary" onclick="editClaim()">Edit</button>
                <button class="btn-secondary" onclick="closeModal('viewModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Edit Claim Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Claim</h3>
                <button class="modal-close" onclick="closeModal('editModal')">&times;</button>
            </div>
            <form id="editForm" onsubmit="saveClaim(event)">
                <div class="form-group">
                    <label for="editStatus">Status</label>
                    <select id="editStatus" required>
                        <option value="Pending">Pending</option>
                        <option value="Under Review">Under Review</option>
                        <option value="Approved">Approved</option>
                        <option value="Rejected">Rejected</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editRemarks">Remarks/Notes</label>
                    <textarea id="editRemarks" placeholder="Add remarks..."></textarea>
                </div>
                <div class="button-group">
                    <button type="submit" class="btn-primary">Save Changes</button>
                    <button type="button" class="btn-secondary" onclick="closeModal('editModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // DATA MANAGEMENT
        let claimsData = JSON.parse(localStorage.getItem('claimsData')) || [];
        let currentEditingClaimId = null;
        let statusChart, typeChart, trendChart;

        // COUNTRIES AND STATES DATA
        const countriesData = {
            'India': ['Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh', 'Goa', 'Gujarat', 'Haryana', 'Himachal Pradesh', 'Jharkhand', 'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur', 'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab', 'Rajasthan', 'Sikkim', 'Tamil Nadu', 'Telangana', 'Tripura', 'Uttar Pradesh', 'Uttarakhand', 'West Bengal', 'Andaman and Nicobar', 'Chandigarh', 'Dadra and Nagar Haveli', 'Daman and Diu', 'Delhi', 'Jammu and Kashmir', 'Ladakh', 'Lakshadweep', 'Puducherry'],
            'United States': ['Alabama', 'Alaska', 'Arizona', 'Arkansas', 'California', 'Colorado', 'Connecticut', 'Delaware', 'Florida', 'Georgia', 'Hawaii', 'Idaho', 'Illinois', 'Indiana', 'Iowa', 'Kansas', 'Kentucky', 'Louisiana', 'Maine', 'Maryland', 'Massachusetts', 'Michigan', 'Minnesota', 'Mississippi', 'Missouri', 'Montana', 'Nebraska', 'Nevada', 'New Hampshire', 'New Jersey', 'New Mexico', 'New York', 'North Carolina', 'North Dakota', 'Ohio', 'Oklahoma', 'Oregon', 'Pennsylvania', 'Rhode Island', 'South Carolina', 'South Dakota', 'Tennessee', 'Texas', 'Utah', 'Vermont', 'Virginia', 'Washington', 'West Virginia', 'Wisconsin', 'Wyoming'],
            'United Kingdom': ['England', 'Scotland', 'Wales', 'Northern Ireland'],
            'Canada': ['Alberta', 'British Columbia', 'Manitoba', 'New Brunswick', 'Newfoundland and Labrador', 'Northwest Territories', 'Nova Scotia', 'Nunavut', 'Ontario', 'Prince Edward Island', 'Quebec', 'Saskatchewan', 'Yukon'],
            'Australia': ['New South Wales', 'Queensland', 'South Australia', 'Tasmania', 'Victoria', 'Western Australia', 'Australian Capital Territory', 'Northern Territory'],
            'Germany': ['Baden-W√ºrttemberg', 'Bavaria', 'Berlin', 'Brandenburg', 'Bremen', 'Hamburg', 'Hesse', 'Lower Saxony', 'Mecklenburg-Vorpommern', 'North Rhine-Westphalia', 'Rhineland-Palatinate', 'Saarland', 'Saxony', 'Saxony-Anhalt', 'Schleswig-Holstein', 'Thuringia'],
            'France': ['√éle-de-France', 'Provence-Alpes-C√¥te d\'Azur', 'Auvergne-Rh√¥ne-Alpes', 'Nouvelle-Aquitaine', 'Occitanie', 'Bourgogne-Franche-Comt√©', 'Normandy', 'Brittany', 'Centre-Val de Loire', 'Corsica', 'Hauts-de-France', 'Grand Est', 'Pays de la Loire'],
            'Japan': ['Hokkaido', 'Aomori', 'Iwate', 'Miyagi', 'Akita', 'Yamagata', 'Fukushima', 'Ibaraki', 'Tochigi', 'Gunma', 'Saitama', 'Chiba', 'Tokyo', 'Kanagawa', 'Niigata', 'Toyama', 'Ishikawa', 'Fukui', 'Yamanashi', 'Nagano', 'Gifu', 'Shizuoka', 'Aichi', 'Mie', 'Shiga', 'Kyoto', 'Osaka', 'Hyogo', 'Nara', 'Wakayama', 'Tottori', 'Shimane', 'Okayama', 'Hiroshima', 'Yamaguchi', 'Tokushima', 'Kagawa', 'Ehime', 'Kochi', 'Fukuoka', 'Saga', 'Nagasaki', 'Kumamoto', 'Oita', 'Miyazaki', 'Kagoshima', 'Okinawa'],
            'Singapore': ['Central', 'East', 'North', 'North-East', 'West'],
            'Malaysia': ['Johor', 'Kedah', 'Kelantan', 'Malacca', 'Negeri Sembilan', 'Pahang', 'Penang', 'Perak', 'Perlis', 'Selangor', 'Terengganu', 'Sabah', 'Sarawak', 'Kuala Lumpur', 'Labuan', 'Putrajaya']
        };

        // INITIALIZATION
        function initializeForm() {
            populateCountries();
            setupEventListeners();
        }

        function populateCountries() {
            const countrySelect = document.getElementById('country');
            Object.keys(countriesData).sort().forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countrySelect.appendChild(option);
            });
        }

        function updateCountries() {
            const selectedCountry = document.getElementById('country').value;
            const stateSelect = document.getElementById('state');
            stateSelect.innerHTML = '<option value="">Select State</option>';

            if (selectedCountry && countriesData[selectedCountry]) {
                countriesData[selectedCountry].forEach(state => {
                    const option = document.createElement('option');
                    option.value = state;
                    option.textContent = state;
                    stateSelect.appendChild(option);
                });
            }
        }

        function updateStateInfo() {
            const state = document.getElementById('state').value;
            const country = document.getElementById('country').value;
            console.log(`Selected: ${state}, ${country}`);
        }

        function setupEventListeners() {
            document.getElementById('claimAmount').addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9.]/g, '');
            });

            document.getElementById('phone').addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
            });

            document.getElementById('aadhar').addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
            });

            document.getElementById('pincode').addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
            });

            document.getElementById('incidentDate').addEventListener('change', function() {
                const selectedDate = new Date(this.value);
                const today = new Date();
                if (selectedDate > today) {
                    this.value = '';
                    showError('incidentDate', 'Future date not allowed');
                }
            });
        }

        // FORM VALIDATION
        function validateForm() {
            clearAllErrors();
            let isValid = true;

            const email = document.getElementById('email').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showError('email', 'Please enter a valid email address');
                isValid = false;
            }

            const phone = document.getElementById('phone').value;
            if (phone.length !== 10) {
                showError('phone', 'Phone number must be 10 digits');
                isValid = false;
            }

            const aadhar = document.getElementById('aadhar').value;
            if (aadhar.length !== 12) {
                showError('aadhar', 'Aadhar number must be 12 digits');
                isValid = false;
            }

            const fullName = document.getElementById('fullName').value;
            if (fullName.length < 3) {
                showError('fullName', 'Name must be at least 3 characters');
                isValid = false;
            }

            const claimAmount = parseFloat(document.getElementById('claimAmount').value);
            if (claimAmount <= 0) {
                showError('claimAmount', 'Claim amount must be greater than 0');
                isValid = false;
            }

            return isValid;
        }

        function showError(fieldId, message) {
            const errorElement = document.getElementById(fieldId + 'Error');
            if (errorElement) {
                errorElement.textContent = message;
            }
        }

        function clearAllErrors() {
            document.querySelectorAll('.error-message').forEach(el => {
                el.textContent = '';
            });
        }

        // CLAIM SUBMISSION
        function submitClaim(event) {
            event.preventDefault();

            if (!validateForm()) {
                showAlert('error', 'Please fix the errors in the form');
                return;
            }

            const claimId = 'CLM' + Date.now();
            const claimData = {
                id: claimId,
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                aadhar: document.getElementById('aadhar').value,
                address: document.getElementById('address').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                country: document.getElementById('country').value,
                pincode: document.getElementById('pincode').value,
                policyNumber: document.getElementById('policyNumber').value,
                claimType: document.getElementById('claimType').value,
                claimAmount: parseFloat(document.getElementById('claimAmount').value),
                incidentDate: document.getElementById('incidentDate').value,
                claimDescription: document.getElementById('claimDescription').value,
                hospitalName: document.getElementById('hospitalName').value,
                treatmentType: document.getElementById('treatmentType').value,
                priority: document.getElementById('priority').value,
                additionalNotes: document.getElementById('additionalNotes').value,
                status: 'Pending',
                submittedDate: new Date().toLocaleDateString(),
                remarks: ''
            };

            claimsData.push(claimData);
            localStorage.setItem('claimsData', JSON.stringify(claimsData));

            document.getElementById('claimId').textContent = claimId;
            showAlert('success');
            document.getElementById('claimForm').reset();

            setTimeout(() => {
                document.getElementById('successAlert').classList.remove('show');
                updateDashboard();
            }, 3000);
        }

        function showAlert(type, message = '') {
            const successAlert = document.getElementById('successAlert');
            const errorAlert = document.getElementById('errorAlert');

            if (type === 'success') {
                successAlert.classList.add('show');
                errorAlert.classList.remove('show');
            } else {
                errorAlert.classList.add('show');
                errorAlert.innerHTML = `<strong>Error!</strong><br>${message}`;
                successAlert.classList.remove('show');
            }
        }

        // TAB SWITCHING
        function switchTab(tabName) {
            document.querySelectorAll('.content-section').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(el => {
                el.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'admin') {
                loadClaimsTable();
            }
        }

        // DASHBOARD FUNCTIONS
        function updateDashboard() {
            const total = claimsData.length;
            const approved = claimsData.filter(c => c.status === 'Approved').length;
            const pending = claimsData.filter(c => c.status === 'Pending').length;
            const rejected = claimsData.filter(c => c.status === 'Rejected').length;

            const totalAmount = claimsData.reduce((sum, c) => sum + c.claimAmount, 0);
            const approvedAmount = claimsData
                .filter(c => c.status === 'Approved')
                .reduce((sum, c) => sum + c.claimAmount, 0);

            document.getElementById('totalClaims').textContent = total;
            document.getElementById('approvedClaims').textContent = approved;
            document.getElementById('pendingClaims').textContent = pending;
            document.getElementById('rejectedClaims').textContent = rejected;
            document.getElementById('totalAmount').textContent = '‚Çπ' + totalAmount.toLocaleString('en-IN');
            document.getElementById('approvedAmount').textContent = '‚Çπ' + approvedAmount.toLocaleString('en-IN');

            updateCharts();
        }

        function updateCharts() {
            const statusData = {
                pending: claimsData.filter(c => c.status === 'Pending').length,
                approved: claimsData.filter(c => c.status === 'Approved').length,
                rejected: claimsData.filter(c => c.status === 'Rejected').length,
                review: claimsData.filter(c => c.status === 'Under Review').length
            };

            // Status Chart
            const statusCtx = document.getElementById('claimStatusChart').getContext('2d');
            if (statusChart) statusChart.destroy();
            statusChart = new Chart(statusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Pending', 'Approved', 'Rejected', 'Under Review'],
                    datasets: [{
                        data: [statusData.pending, statusData.approved, statusData.rejected, statusData.review],
                        backgroundColor: ['#f59e0b', '#10b981', '#ef4444', '#3b82f6'],
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        },
                        title: {
                            display: true,
                            text: 'Claim Status Distribution'
                        }
                    }
                }
            });

            // Type Chart
            const typeData = {};
            claimsData.forEach(c => {
                typeData[c.claimType] = (typeData[c.claimType] || 0) + 1;
            });

            const typeCtx = document.getElementById('claimTypeChart').getContext('2d');
            if (typeChart) typeChart.destroy();
            typeChart = new Chart(typeCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(typeData),
                    datasets: [{
                        label: 'Number of Claims',
                        data: Object.values(typeData),
                        backgroundColor: '#2563eb',
                        borderColor: '#1e40af',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Claims by Type'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Trend Chart
            const trendData = {};
            claimsData.forEach(c => {
                trendData[c.submittedDate] = (trendData[c.submittedDate] || 0) + 1;
            });

            const trendCtx = document.getElementById('claimTrendChart').getContext('2d');
            if (trendChart) trendChart.destroy();
            trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: Object.keys(trendData).sort(),
                    datasets: [{
                        label: 'Claims Per Day',
                        data: Object.values(trendData),
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Claims Trend Over Time'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ADMIN FUNCTIONS
        function loadClaimsTable() {
            const tableBody = document.getElementById('claimsTableBody');

            if (claimsData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-light);">No claims submitted yet</td></tr>';
                return;
            }

            tableBody.innerHTML = claimsData.map(claim => `
                <tr>
                    <td><strong>${claim.id}</strong></td>
                    <td>${claim.fullName}</td>
                    <td>${claim.claimType}</td>
                    <td>‚Çπ${claim.claimAmount.toLocaleString('en-IN')}</td>
                    <td>
                        <span class="badge badge-${getStatusBadgeClass(claim.status)}">
                            ${claim.status}
                        </span>
                    </td>
                    <td>${claim.submittedDate}</td>
                    <td>
                        <span class="badge badge-${getPriorityBadgeClass(claim.priority)}">
                            ${claim.priority}
                        </span>
                    </td>
                    <td>
                        <button class="btn-primary btn-sm" onclick="viewClaim('${claim.id}')">View</button>
                        <button class="btn-warning btn-sm" onclick="openEditModal('${claim.id}')">Edit</button>
                        <button class="btn-danger btn-sm" onclick="deleteClaim('${claim.id}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function getStatusBadgeClass(status) {
            const statusMap = {
                'Approved': 'success',
                'Pending': 'warning',
                'Rejected': 'danger',
                'Under Review': 'info'
            };
            return statusMap[status] || 'info';
        }

        function getPriorityBadgeClass(priority) {
            const priorityMap = {
                'Normal': 'info',
                'High': 'warning',
                'Urgent': 'danger'
            };
            return priorityMap[priority] || 'info';
        }

        function viewClaim(claimId) {
            const claim = claimsData.find(c => c.id === claimId);
            if (!claim) return;

            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `
                <div class="form-grid">
                    <div><strong>Claim ID:</strong> ${claim.id}</div>
                    <div><strong>Name:</strong> ${claim.fullName}</div>
                    <div><strong>Email:</strong> ${claim.email}</div>
                    <div><strong>Phone:</strong> ${claim.phone}</div>
                    <div><strong>Policy Number:</strong> ${claim.policyNumber}</div>
                    <div><strong>Claim Type:</strong> ${claim.claimType}</div>
                    <div><strong>Amount:</strong> ‚Çπ${claim.claimAmount.toLocaleString('en-IN')}</div>
                    <div><strong>Status:</strong> <span class="badge badge-${getStatusBadgeClass(claim.status)}">${claim.status}</span></div>
                    <div><strong>Priority:</strong> ${claim.priority}</div>
                    <div><strong>Incident Date:</strong> ${claim.incidentDate}</div>
                    <div><strong>Address:</strong> ${claim.address}, ${claim.city}, ${claim.state}, ${claim.country} - ${claim.pincode}</div>
                    <div style="grid-column: 1 / -1;"><strong>Description:</strong> ${claim.claimDescription}</div>
                    <div style="grid-column: 1 / -1;"><strong>Hospital:</strong> ${claim.hospitalName || 'N/A'}</div>
                    <div><strong>Treatment Type:</strong> ${claim.treatmentType || 'N/A'}</div>
                    <div><strong>Submitted Date:</strong> ${claim.submittedDate}</div>
                    <div style="grid-column: 1 / -1;"><strong>Remarks:</strong> ${claim.remarks || 'No remarks'}</div>
                </div>
            `;

            currentEditingClaimId = claimId;
            openModal('viewModal');
        }

        function openEditModal(claimId) {
            const claim = claimsData.find(c => c.id === claimId);
            if (!claim) return;

            currentEditingClaimId = claimId;
            document.getElementById('editStatus').value = claim.status;
            document.getElementById('editRemarks').value = claim.remarks;
            openModal('editModal');
        }

        function saveClaim(event) {
            event.preventDefault();

            const claim = claimsData.find(c => c.id === currentEditingClaimId);
            if (!claim) return;

            claim.status = document.getElementById('editStatus').value;
            claim.remarks = document.getElementById('editRemarks').value;

            localStorage.setItem('claimsData', JSON.stringify(claimsData));
            closeModal('editModal');
            loadClaimsTable();
            updateDashboard();
            showAlert('success', 'Claim updated successfully');
        }

        function deleteClaim(claimId) {
            if (confirm('Are you sure you want to delete this claim?')) {
                claimsData = claimsData.filter(c => c.id !== claimId);
                localStorage.setItem('claimsData', JSON.stringify(claimsData));
                loadClaimsTable();
                updateDashboard();
                showAlert('success', 'Claim deleted successfully');
            }
        }

        function filterClaims() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const claimTypeFilter = document.getElementById('claimTypeFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;

            const filteredData = claimsData.filter(claim =>
                (claim.id.toLowerCase().includes(searchInput) ||
                    claim.fullName.toLowerCase().includes(searchInput) ||
                    claim.policyNumber.toLowerCase().includes(searchInput)) &&
                (statusFilter === '' || claim.status === statusFilter) &&
                (claimTypeFilter === '' || claim.claimType === claimTypeFilter) &&
                (priorityFilter === '' || claim.priority === priorityFilter)
            );

            const tableBody = document.getElementById('claimsTableBody');
            if (filteredData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-light);">No claims found</td></tr>';
                return;
            }

            tableBody.innerHTML = filteredData.map(claim => `
                <tr>
                    <td><strong>${claim.id}</strong></td>
                    <td>${claim.fullName}</td>
                    <td>${claim.claimType}</td>
                    <td>‚Çπ${claim.claimAmount.toLocaleString('en-IN')}</td>
                    <td>
                        <span class="badge badge-${getStatusBadgeClass(claim.status)}">
                            ${claim.status}
                        </span>
                    </td>
                    <td>${claim.submittedDate}</td>
                    <td>
                        <span class="badge badge-${getPriorityBadgeClass(claim.priority)}">
                            ${claim.priority}
                        </span>
                    </td>
                    <td>
                        <button class="btn-primary btn-sm" onclick="viewClaim('${claim.id}')">View</button>
                        <button class="btn-warning btn-sm" onclick="openEditModal('${claim.id}')">Edit</button>
                        <button class="btn-danger btn-sm" onclick="deleteClaim('${claim.id}')">Delete</button>
                    </td>
                </tr>
            `).join('');
        }

        function exportToCSV() {
            if (claimsData.length === 0) {
                alert('No data to export');
                return;
            }

            const headers = ['Claim ID', 'Name', 'Email', 'Phone', 'Policy Number', 'Claim Type', 'Amount', 'Status', 'Priority', 'Date', 'State', 'Country'];
            const csvContent = [
                headers.join(','),
                ...claimsData.map(c =>
                    `"${c.id}","${c.fullName}","${c.email}","${c.phone}","${c.policyNumber}","${c.claimType}","${c.claimAmount}","${c.status}","${c.priority}","${c.submittedDate}","${c.state}","${c.country}"`
                )
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `claims_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
        }

        function exportToPDF() {
            if (claimsData.length === 0) {
                alert('No data to export');
                return;
            }

            const element = document.getElementById('claimsTable');
            const opt = {
                margin: 10,
                filename: `claims_${new Date().toISOString().split('T')[0]}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { orientation: 'landscape', unit: 'mm', format: 'a4' }
            };
            html2pdf().set(opt).from(element).save();
        }

        function printClaims() {
            const printWindow = window.open('', '', 'height=600,width=800');
            const table = document.getElementById('claimsTable').innerHTML;
            printWindow.document.write('<html><head><title>Claims Report</title>');
            printWindow.document.write('<style>table{border-collapse:collapse;width:100%;}th,td{border:1px solid black;padding:8px;text-align:left;}th{background-color:#f2f2f2;}</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write('<h2>Insurance Claims Report</h2>');
            printWindow.document.write(table);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        }

        // MODAL FUNCTIONS
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function editClaim() {
            const claim = claimsData.find(c => c.id === currentEditingClaimId);
            if (claim) {
                closeModal('viewModal');
                openEditModal(currentEditingClaimId);
            }
        }

        // INITIALIZE ON PAGE LOAD
        window.addEventListener('load', initializeForm);
    </script>
</body>
</html>
